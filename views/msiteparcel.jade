extend layoutm

block head
  link(rel="stylesheet", href="css/easy-autocomplete.min.css")
  link(rel="stylesheet", href="css/easy-autocomplete.themes.min.css")

block content
  // content
  section.section
    h1 #{__('Packet24 parcels delivery')}
    ul.breadcrumbs
      li #{__('You are here')}
      li
        i.fa.fa-angle-double-right
        a(href='/?m=1') #{__('Home')}
      li
        i.fa.fa-angle-double-right
        span #{__('About my parcel')}
    .container
      form.form#inputform(action='/make/parcel', method='POST')
        .form-block.bordered
          i.icons-profile
          h3 #{__('From')}
          p
            input#address1(type='checkbox', name='fromPersonProfile')
            label.map_checkbox(for='address1') #{__('Choose my profile address')}
            i.icons-arrow.fill_adress1.js-toggle_address1#address1btn
          .hidden_address1
            input(type='text', placeholder='First name, for ex.: “George”', name='fromPerson.firstName')
            input(type='text', placeholder='Last name, for ex.: “Bohorquez”', name='fromPerson.lastName')
            input(type='text', placeholder='Adress (street), for ex.: “Way to the ocean”', name='fromPerson.address1')
            input(type='text', placeholder='Adress (number), for ex.: “777”', name='fromPerson.address2')
            input(type='text', placeholder='Zip Code, for ex.: “456-78”', name='fromPerson.zip')
            input(type='text', placeholder='City, for ex.: “San Francisco”', name='fromPerson.city')
            input#fromCountry(type='text', placeholder='Country, for ex.: “United States”', name='fromPerson.country')
            input(type='text', placeholder='Mobile phone, for ex.: “001 999 4611 8937”', name='fromPerson.phone')
            input(type='text', placeholder='E-mail, for ex.: “George@delti.com”', name='fromPerson.email')
          h3 #{__('To')}
          p
            input#address2(type='checkbox', name='toPersonProfile')
            label.map_checkbox(for='address2') #{__('Choose my profile address')}
            i.icons-arrow.fill_adress1.js-toggle_address2#address2btn
          .hidden_address2
            input(type='text', placeholder='First name, for ex.: “George”', name='toPerson.firstName')
            input(type='text', placeholder='Last name, for ex.: “Bohorquez”', name='toPerson.lastName')
            input(type='text', placeholder='Adress (street), for ex.: “Way to the ocean”', name='toPerson.address1')
            input(type='text', placeholder='Adress (number), for ex.: “777”', name='toPerson.address2')
            input(type='text', placeholder='Zip Code, for ex.: “456-78”', name='toPerson.zip')
            input(type='text', placeholder='City, for ex.: “San Francisco”', name='toPerson.city')
            input#toCountry(type='text', placeholder='Country, for ex.: “United States”', name='toPerson.country')
            input(type='text', placeholder='Mobile phone, for ex.: “001 999 4611 8937”', name='toPerson.phone')
            input(type='text', placeholder='E-mail, for ex.: “George@delti.com”', name='toPerson.email')
          input#packetshop(type='checkbox', name='usePacketshop')
          label.packetshop(for='packetshop') #{__('To reduce costs, I am willing to drop the package in a Packetshop close to me.')}
          //a.orange_button(href='#') GO TO &quot;MY PROFILE&quot;
        .form-block.bordered
          i.icons-parcel
          h3(align='left') #{__('ABOUT MY PARCEL')}
          .form-sizes_scroll
            ul.form-sizes
              li
                span.up
                  i.fa.fa-chevron-up
                input.numbers(type='text', pattern='[0-9]*', inputmode='numeric', placeholder='0', name='weight', value='1')
                em #{__('kg')}
                span.down
                  i.fa.fa-chevron-down
                strong #{__('Weight')}
              li
                span.up
                  i.fa.fa-chevron-up
                input.numbers(type='text', pattern='[0-9]*', inputmode='numeric', placeholder='0', name='length', value='20')
                em #{__('cm')}
                span.down
                  i.fa.fa-chevron-down
                strong #{__('Length')}
              li
                span.up
                  i.fa.fa-chevron-up
                input.numbers(type='text', pattern='[0-9]*', inputmode='numeric', placeholder='0', name='width', value='5')
                em #{__('cm')}
                span.down
                  i.fa.fa-chevron-down
                strong #{__('Width')}
              li
                span.up
                  i.fa.fa-chevron-up
                input.numbers(type='text', pattern='[0-9]*', inputmode='numeric', placeholder='0', name='depth', value='5')
                em #{__('cm')}
                span.down
                  i.fa.fa-chevron-down
                strong Depth
          //input#declare(type='checkbox', name='userAgreementContent')
          //label.declare(for='declare')
            | #{__('I officially declare that non of the products transported areprohibited neither in origin country, neither in destination country. It is under my responsabili')}
        .form-block.bordered
          i.icons-timing
          h3 #{__('About the timing')}
          .confirmation-select-mobile
            span.placeholder1 #{__('Parcel can be picked up starting')}
            span.placeholder2 #{__('Parcel should arrive before')}
            input.pl1#pickupDate(type='datetime-local', placeholder='')
            input.pl2#arriveDate(type='datetime-local', placeholder='')
          input#timing(type='checkbox', name='userAgreementTimes')
          label.timing(for='timing') #{__('I am aware that the time frame influences Packet24 prices.')}
        //.form-block.bordered
          i.icons-insurrance
          h3 #{__('About insurrance')}
          input(type='text', placeholder='Packet is insured until the value XXX€', name='insurrance')
        button.orange_button #{__('Send')}
        .clear
      #fill_address1.popup_adress
        h3
          span.b-close #{__('Cancel')}
          |  #{__('Fill the adress form below')} 
          a(href='javascript:saveAddress1();') #{__('Done')}
        form.popup_address1#formAddress1
          input(type='text', placeholder='First name, for ex.: “George”', name='fromPerson.firstName')
          input(type='text', placeholder='Last name, for ex.: “Bohorquez”', name='fromPerson.lastName')
          input(type='text', placeholder='Adress (street), for ex.: “Way to the ocean”', name='fromPerson.address1')
          input(type='text', placeholder='Adress (number), for ex.: “777”', name='fromPerson.address2')
          input(type='text', placeholder='Zip Code, for ex.: “456-78”', name='fromPerson.zip')
          input(type='text', placeholder='City, for ex.: “San Francisco”', name='fromPerson.city')
          input(type='text', placeholder='Country, for ex.: “United States”', name='fromPerson.country')
          input(type='text', placeholder='Mobile phone, for ex.: “001 999 4611 8937”', name='fromPerson.phone')
          input(type='text', placeholder='E-mail, for ex.: “George@delti.com”', name='fromPerson.email')
      #fill_address2.popup_adress
        h3
          span.b-close #{__('Cancel')}
          |  #{__('Fill the adress form below')} 
          a(href='javascript:saveAddress2();') #{__('Done')}
        form.popup_address1#formAddress2
          input(type='text', placeholder='First name, for ex.: “George”', name='toPerson.firstName')
          input(type='text', placeholder='Last name, for ex.: “Bohorquez”', name='toPerson.lastName')
          input(type='text', placeholder='Adress (street), for ex.: “Way to the ocean”', name='toPerson.address1')
          input(type='text', placeholder='Adress (number), for ex.: “777”', name='toPerson.address2')
          input(type='text', placeholder='Zip Code, for ex.: “456-78”', name='toPerson.zip')
          input(type='text', placeholder='City, for ex.: “San Francisco”', name='toPerson.city')
          input(type='text', placeholder='Country, for ex.: “United States”', name='toPerson.country')
          input(type='text', placeholder='Mobile phone, for ex.: “001 999 4611 8937”', name='toPerson.phone')
          input(type='text', placeholder='E-mail, for ex.: “George@delti.com”', name='toPerson.email')

block script
  script(src="vendor/jquery/jquery.easy-autocomplete.min.js")
  script(type='text/javascript').
    var options = {
      url: "/countries_es.json",
      getValue: "name",
      list: { 
        match: {
          enabled: true
        }
      },
      theme: "square"
    };
    $("#fromCountry").easyAutocomplete(options);
    $("#toCountry").easyAutocomplete(options);

    $(document).keypress(function(event) {
      var keycode = (event.keyCode ? event.keyCode : event.which);
      if(keycode == '13') {
        if(window.address1Modal)
          window.address1Modal.close();
        if(window.address2Modal)
          window.address2Modal.close();
      }
    });
    function saveAddress1() {
      form = $('#formAddress1').serialize();
      console.log('Save address1', form);
      window.formAddress1 = form;
      window.address1Modal.close();
    }
    function saveAddress2() {
      form = $('#formAddress2').serialize();
      console.log('Save address2', form);
      window.formAddress2 = form;
      window.address2Modal.close();
    }
    $('#address1btn').click(function() {
      //window.address1Modal = $('#fill_address1').bPopup({follow: [false, false], position: [0, 0]});
    });
    $('#address2btn').click(function() {
      //window.address2Modal = $('#fill_address2').bPopup({follow: [false, false], position: [0, 0]});
    });
    $('#inputform').submit(function(event) {
      event.preventDefault();
      $('#pickupDate').removeClass('error');
      $('#arriveDate').removeClass('error');
      $('#address1').removeClass('error');
      $('#address2').removeClass('error');
      pickupDate = moment($('#pickupDate').attr('value'))
      if(!pickupDate.isValid()) {
        pickupDate = moment($('#pickupDate').attr('value'), 'DD.MM.YYYY, HH:mm')
      }
      d1 = moment().diff(pickupDate, 'days');
      if(!pickupDate.isValid() || d1 > 0) {
        $('#pickupDate').addClass('error');
        return false;
      }
      arriveDate = moment($('#arriveDate').attr('value'))
      if(!arriveDate.isValid()) {
        arriveDate = moment($('#arriveDate').attr('value'), 'DD.MM.YYYY, HH:mm')
      }
      d2 = moment().diff(arriveDate, 'days');
      if(!arriveDate.isValid() || d2 > d1 || d2 < -30) {
        $('#arriveDate').addClass('error');
        return false;
      }
      //$('#pickupDate').attr('value', pickupDate.format('DD.MM.YYYY'));
      //$('#arriveDate').attr('value', arriveDate.format('DD.MM.YYYY'));
      regdata = $(this).serialize();
      if(!this[0].checked) {
        //regdata = regdata + '&' + window.formAddress1;
        //regdata = regdata + '&fromPerson.firstName=Sherlok&fromPerson.lastName=Holms&fromPerson.address1=Friedrich%20Missler%20Strasse&fromPerson.address2=1&fromPerson.zip=28211&fromPerson.city=Bremen&fromPerson.country=England&fromPerson.phone=123456&fromPersons.email=sherlok@me.com';
      }
      if(!this[1].checked) {
        //regdata = regdata + '&' + window.formAddress2;
        //regdata = regdata + '&toPerson.firstName=Sherlok&toPerson.lastName=Holms&toPerson.address1=Friedrich Missler Strasse&toPerson.address2=1&toPerson.zip=28211&toPerson.city=Bremen&toPerson.country=England&toPerson.phone=123456&toPersons.email=sherlok@me.com';
      }
      regdata = regdata + '&pickupDate='+pickupDate.format();
      regdata = regdata + '&arriveDate='+arriveDate.format();
      $.ajax({
        type: 'POST',
        url: this.action,
        data: regdata,
        success: function(data) {
          console.log('Result', data);
          location.href = '/price/'+data.parcel+'?m=1';
        },
        error: function(err) {
          console.log("Error", err);
          if(err.responseText == 'From address error') {
            $('#address1').addClass('error');
          } else if(err.responseText == 'To address error') {
            $('#address2').addClass('error');
          }
        }});
      return false;
    });
  